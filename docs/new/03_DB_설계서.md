# ğŸ—„ï¸ ì½ì“° ë¬¸í•´ë ¥ í•™ìŠµ í”Œë«í¼ - ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ì„œ (DDS)

**Database Design Specification**  
**ë¬¸ì„œ ë²„ì „:** v1.0  
**ì‘ì„±ì¼:** 2025-10-23  
**DBMS:** MySQL 8.0+  
**ì›ë³¸ ê¸°íšì„œ:** icks_literacy_plan_20251020.pdf  

---

## ğŸ“‹ ëª©ì°¨
1. [ë°ì´í„°ë² ì´ìŠ¤ ê°œìš”](#1-ë°ì´í„°ë² ì´ìŠ¤-ê°œìš”)
2. [ERD (Entity Relationship Diagram)](#2-erd-entity-relationship-diagram)
3. [í…Œì´ë¸” ìƒì„¸ ì„¤ê³„](#3-í…Œì´ë¸”-ìƒì„¸-ì„¤ê³„)
4. [ì¸ë±ìŠ¤ ì„¤ê³„](#4-ì¸ë±ìŠ¤-ì„¤ê³„)
5. [DDL (Data Definition Language)](#5-ddl-data-definition-language)
6. [í™•ì¥ ì„¤ê³„](#6-í™•ì¥-ì„¤ê³„)
7. [ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜](#7-ë°ì´í„°-ë§ˆì´ê·¸ë ˆì´ì…˜)

---

## 1. ë°ì´í„°ë² ì´ìŠ¤ ê°œìš”

### 1.1 ì„¤ê³„ ì›ì¹™
```yaml
ì •ê·œí™”: 3NF (Third Normal Form) ì¤€ìˆ˜
ê¸°ë³¸í‚¤: UUID BINARY(16) ì‚¬ìš© - ìµœì í™”ëœ UUID v7 ë°©ì‹
ë¬¸ì ì¸ì½”ë”©: utf8mb4 (ëª¨ë“  ìœ ë‹ˆì½”ë“œ ë¬¸ì ì§€ì›, ì´ëª¨ì§€ í¬í•¨)
ì½œë ˆì´ì…˜: utf8mb4_0900_ai_ci (MySQL 8.0+ ìµœì‹  ìœ ë‹ˆì½”ë“œ í‘œì¤€)
ìŠ¤í† ë¦¬ì§€ ì—”ì§„: InnoDB
ë‚ ì§œ/ì‹œê°„: DATETIME(6) - ë§ˆì´í¬ë¡œì´ˆ ì§€ì›
ì™¸ë˜í‚¤: ì°¸ì¡° ë¬´ê²°ì„± ì œì•½ì¡°ê±´ ì ìš©
```

**UUID BINARY(16) ì„ íƒ ì´ìœ **:
- **ì €ì¥ ê³µê°„ 55% ì ˆì•½**: CHAR(36) ëŒ€ë¹„ 16 bytesë¡œ ì••ì¶• (36 bytes â†’ 16 bytes)
- **ì„±ëŠ¥ ê°œì„ **: UUID v7 ìˆœì°¨ì„±ìœ¼ë¡œ INSERT ì„±ëŠ¥ í–¥ìƒ (í˜ì´ì§€ ë¶„í•  ìµœì†Œí™”)
- **ë³´ì•ˆ ê°•í™”**: UUID ê³ ìœ ì„± ìœ ì§€, ID ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥ (í•™ìƒ ì •ë³´ ë³´í˜¸)
- **ë¶„ì‚° í™•ì¥**: ë‹¤ì¤‘ ì„œë²„ í™˜ê²½ì—ì„œ ID ì¶©ëŒ ì—†ì´ ë…ë¦½ ìƒì„± ê°€ëŠ¥
- **MySQL 8.0+ ìµœì í™”**: UUID_TO_BIN(UUID(), 1) ë„¤ì´í‹°ë¸Œ í•¨ìˆ˜ í™œìš©

**UUID ìƒì„± ë°©ì‹**:
```sql
-- ê¸°ë³¸í‚¤ ìƒì„±
DEFAULT (UUID_TO_BIN(UUID(), 1))

-- swap_flag = 1: íƒ€ì„ìŠ¤íƒ¬í”„ ë¶€ë¶„ì„ ì•ìœ¼ë¡œ ë°°ì¹˜í•˜ì—¬ ìˆœì°¨ì„± í™•ë³´
-- ì˜ˆ: 550e8400-e29b-41d4-a716-446655440000 (36 bytes)
--  â†’ 0x550ee29b41d4a716446655440000e284 (16 bytes, ìˆœì°¨ ì •ë ¬)
```

**ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ ë³€í™˜**:
```sql
-- INSERT: ë¬¸ìì—´ UUID â†’ BINARY
INSERT INTO user (user_id, name)
VALUES (UUID_TO_BIN('550e8400-e29b-41d4-a716-446655440000', 1), 'í™ê¸¸ë™');

-- SELECT: BINARY â†’ ë¬¸ìì—´ UUID
SELECT BIN_TO_UUID(user_id, 1) as user_id, name FROM user;
```

**ì½œë ˆì´ì…˜ ì„ íƒ ì´ìœ **:
- `utf8mb4_0900_ai_ci`: MySQL 8.0+ ê¸°ë³¸ê°’, ìµœì‹  ìœ ë‹ˆì½”ë“œ í‘œì¤€(UCA 9.0.0) ì¤€ìˆ˜
- í•œê¸€ í…ìŠ¤íŠ¸ ì •ë ¬ ì •í™•ë„ í–¥ìƒ
- ì´ëª¨ì§€ ë° íŠ¹ìˆ˜ë¬¸ì ì •ë ¬ ê°œì„  (í•™ìƒ í”¼ë“œë°±, ì„œìˆ  ìš”ì•½ì—ì„œ ì´ëª¨ì§€ ì‚¬ìš© ê°€ëŠ¥)
- ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ëŠ” ê²€ìƒ‰ (AI: Accent Insensitive, CI: Case Insensitive)
- í–¥í›„ ë‹¤êµ­ì–´ í™•ì¥ ì‹œ ì•ˆì •ì  ì§€ì›

**íŠ¹ìˆ˜ ì»¬ëŸ¼ ì˜ˆì™¸**:
- `coupon.coupon_code`: `utf8mb4_bin` ì‚¬ìš© (ì¿ í° ì½”ë“œ ëŒ€ì†Œë¬¸ì êµ¬ë¶„ í•„ìš”)

### 1.2 í…Œì´ë¸” ë¶„ë¥˜

#### í•µì‹¬ í…Œì´ë¸” (13ê°œ)
```
â”œâ”€â”€ user                    # ì‚¬ìš©ì ì •ë³´
â”œâ”€â”€ book_volume            # ê¶Œ ë©”íƒ€ë°ì´í„°
â”œâ”€â”€ lesson                 # ê°•ì¢Œ ì •ë³´
â”œâ”€â”€ license                # ë¼ì´ì„ ìŠ¤ ê´€ë¦¬
â”œâ”€â”€ lesson_attempt         # ì°¨ì‹œ ìˆ˜í–‰
â”œâ”€â”€ section_result         # êµ¬ê°„ë³„ ê²°ê³¼
â”œâ”€â”€ vocabulary             # ì–´íœ˜ ì •ë³´
â”œâ”€â”€ vocab_problem          # ì–´íœ˜ ë¬¸ì œ
â”œâ”€â”€ vocab_learning         # ì–´íœ˜ í•™ìŠµ í˜„í™©
â”œâ”€â”€ summary                # ì„œìˆ  ìš”ì•½
â”œâ”€â”€ quest                  # í€˜ìŠ¤íŠ¸
â”œâ”€â”€ quest_progress         # í€˜ìŠ¤íŠ¸ ì§„í–‰
â””â”€â”€ notification           # ì•Œë¦¼
```

#### í™•ì¥ í…Œì´ë¸” (10ê°œ)
```
â”œâ”€â”€ vocab_learning_result  # ì–´íœ˜ í•™ìŠµ ê²°ê³¼
â”œâ”€â”€ quest_product          # í€˜ìŠ¤íŠ¸ ìƒí’ˆ
â”œâ”€â”€ quest_history          # í€˜ìŠ¤íŠ¸ ì´ë ¥
â”œâ”€â”€ coupon                 # ì¿ í° ê´€ë¦¬
â”œâ”€â”€ activity_log           # í•™ìŠµ í™œë™ ë¡œê·¸
â”œâ”€â”€ volume_progress_cache  # ì§„í–‰ë¥  ìºì‹œ
â”œâ”€â”€ daily_learning_stats   # ì¼ë³„ í†µê³„
â”œâ”€â”€ user_behavior_log      # ì‚¬ìš©ì í–‰ë™ ë¡œê·¸
â”œâ”€â”€ learning_feature       # AI í•™ìŠµ í”¼ì²˜
â””â”€â”€ user_feedback          # ì‚¬ìš©ì í”¼ë“œë°±
```

### 1.3 ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì„±

```sql
CREATE DATABASE icks_literacy
  DEFAULT CHARACTER SET utf8mb4
  DEFAULT COLLATE utf8mb4_0900_ai_ci;

USE icks_literacy;
```

---

## 2. ERD (Entity Relationship Diagram)

### 2.1 í•µì‹¬ ê´€ê³„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   user   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   license    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚book_volumeâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   1:N   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   N:1   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                      â”‚                        â”‚
     â”‚ 1:N                  â”‚ 1:N                    â”‚ 1:N
     â”‚                      â”‚                        â”‚
     â–¼                      â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚vocab_    â”‚         â”‚lesson_attemptâ”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚  lesson  â”‚
â”‚learning  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   N:1   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                        â”‚
     â”‚                     â”‚ 1:N                    â”‚ 1:N
     â”‚ N:1                 â–¼                        â–¼
     â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚section_resultâ”‚         â”‚vocabularyâ”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                      â”‚
            â”‚ 1:N                                  â”‚ 1:N
            â–¼                                      â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ summary  â”‚                          â”‚vocab_    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚problem   â”‚
                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   user   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    quest     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚quest_    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   1:N   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   N:1   â”‚product   â”‚
                           â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ 1:N
                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â–¼           â–¼           â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚quest_    â”‚â”‚quest_    â”‚â”‚  coupon  â”‚
                     â”‚progress  â”‚â”‚history   â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ê´€ê³„ ìš”ì•½í‘œ

| ë¶€ëª¨ í…Œì´ë¸” | ê´€ê³„ | ìì‹ í…Œì´ë¸” | ì„¤ëª… |
|------------|------|------------|------|
| user | 1:N | license | ì‚¬ìš©ìëŠ” ì—¬ëŸ¬ ë¼ì´ì„ ìŠ¤ ë³´ìœ  |
| book_volume | 1:N | license | ê¶Œì€ ì—¬ëŸ¬ ë¼ì´ì„ ìŠ¤ë¡œ ë¶€ì—¬ |
| book_volume | 1:N | lesson | ê¶Œì€ ì—¬ëŸ¬ ê°•ì¢Œ í¬í•¨ |
| user | 1:N | lesson_attempt | ì‚¬ìš©ìëŠ” ì—¬ëŸ¬ ì°¨ì‹œ ìˆ˜í–‰ |
| license | 1:N | lesson_attempt | ë¼ì´ì„ ìŠ¤ë‹¹ ì—¬ëŸ¬ ì°¨ì‹œ |
| lesson | 1:N | lesson_attempt | ê°•ì¢ŒëŠ” ì—¬ëŸ¬ ì°¨ì‹œë¡œ ì‹œë„ |
| lesson_attempt | 1:N | section_result | ì°¨ì‹œëŠ” 9ê°œ êµ¬ê°„ ê²°ê³¼ |
| lesson | 1:N | vocabulary | ê°•ì¢ŒëŠ” ì—¬ëŸ¬ ì–´íœ˜ í¬í•¨ |
| vocabulary | 1:N | vocab_problem | ì–´íœ˜ë‹¹ 3ê°œ ë¬¸ì œ |
| user | 1:N | vocab_learning | ì‚¬ìš©ìëŠ” ì—¬ëŸ¬ ì–´íœ˜ í•™ìŠµ |
| vocabulary | 1:N | vocab_learning | ì–´íœ˜ëŠ” ì—¬ëŸ¬ ì‚¬ìš©ìê°€ í•™ìŠµ |
| vocab_learning | 1:N | vocab_learning_result | ì–´íœ˜ í•™ìŠµ ê²°ê³¼ ì´ë ¥ |
| user | 1:N | summary | ì‚¬ìš©ìëŠ” ì—¬ëŸ¬ ìš”ì•½ ì‘ì„± |
| lesson | 1:N | summary | ê°•ì¢Œë‹¹ 1ê°œ ìš”ì•½ |
| user | 1:N | quest | ì‚¬ìš©ìëŠ” ì—¬ëŸ¬ í€˜ìŠ¤íŠ¸ ìˆ˜í–‰ |
| quest_product | 1:N | quest | ìƒí’ˆì€ ì—¬ëŸ¬ í€˜ìŠ¤íŠ¸ì— ì„ íƒ |
| quest | 1:N | quest_progress | í€˜ìŠ¤íŠ¸ë‹¹ 4ê°œ ì§„í–‰ ìƒí™© |
| quest | 1:N | quest_history | í€˜ìŠ¤íŠ¸ í™œë™ ì´ë ¥ |
| quest | 1:N | coupon | í€˜ìŠ¤íŠ¸ ì™„ë£Œ ì‹œ ì¿ í° ë°œê¸‰ |
| user | 1:N | notification | ì‚¬ìš©ìëŠ” ì—¬ëŸ¬ ì•Œë¦¼ ìˆ˜ì‹  |

---

## 3. í…Œì´ë¸” ìƒì„¸ ì„¤ê³„

### 3.1 ì‚¬ìš©ì ê´€ë¦¬

#### ğŸ“Œ user (ì‚¬ìš©ì)

**í…Œì´ë¸” ì„¤ëª…**: í•™ìƒ ë° ê´€ë¦¬ì ì •ë³´

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| user_id | BINARY(16) | NO | - | ì‚¬ìš©ì ID (PK, UUID) |
| name | VARCHAR(100) | NO | - | ì´ë¦„ |
| grade | VARCHAR(20) | YES | NULL | í•™ë…„ ì •ë³´ |
| user_type | ENUM('student','admin') | NO | 'student' | ì‚¬ìš©ì ìœ í˜• |
| profile_image | VARCHAR(255) | YES | NULL | í”„ë¡œí•„ ì´ë¯¸ì§€ URL |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |
| updated_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìˆ˜ì • ì¼ì‹œ |

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (user_id)
- INDEX idx_name (name)
- INDEX idx_grade (grade)

---

### 3.2 êµì¬ ë° ê°•ì¢Œ

#### ğŸ“Œ book_volume (ê¶Œ)

**í…Œì´ë¸” ì„¤ëª…**: 1~15ê¶Œ ë©”íƒ€ë°ì´í„°

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| volume_id | BINARY(16) | NO | - | ê¶Œ ID (PK, UUID) |
| volume_number | INT | NO | - | ê¶Œ ë²ˆí˜¸ (1~15, UNIQUE) |
| title | VARCHAR(255) | NO | - | ê¶Œ ì œëª© |
| stage | ENUM('A','B','C') | NO | - | ë‚œì´ë„ ë‹¨ê³„ |
| total_lessons | INT | NO | - | ì´ ê°•ì¢Œ ìˆ˜ (12 or 15) |
| avg_word_count | VARCHAR(50) | YES | NULL | í‰ê·  ê¸€ì ìˆ˜ ë²”ìœ„ |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (volume_id)
- UNIQUE KEY uk_volume_number (volume_number)
- INDEX idx_volume_number (volume_number)

**ë°ì´í„° ì˜ˆì‹œ**:
```sql
INSERT INTO book_volume VALUES
('uuid-1', 1, '1ê¶Œ', 'A', 12, '1~3', NOW(6)),
('uuid-2', 2, '2ê¶Œ', 'A', 12, '1~3', NOW(6));
```

---

#### ğŸ“Œ lesson (ê°•ì¢Œ)

**í…Œì´ë¸” ì„¤ëª…**: ê°•ì¢Œ ì •ë³´ ë° ì§€ë¬¸ ë°ì´í„°

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| lesson_id | BINARY(16) | NO | - | ê°•ì¢Œ ID (PK, UUID) |
| volume_id | BINARY(16) | NO | - | ê¶Œ ID (FK) |
| lesson_number | INT | NO | - | ê°• ë²ˆí˜¸ |
| title | VARCHAR(255) | NO | - | ì§€ë¬¸ ì œëª© |
| word_count | INT | YES | NULL | ì§€ë¬¸ ê¸€ì ìˆ˜ |
| content_image | VARCHAR(255) | YES | NULL | ì œëª©ì½ê¸° ì´ë¯¸ì§€ URL |
| passage_text | TEXT | YES | NULL | ê°•ì¢Œ ì§€ë¬¸ ë‚´ìš© |
| reading_target_time | INT | YES | NULL | ëª©í‘œ ì½ê¸° ì‹œê°„(ì´ˆ) |
| reading_limit_time | INT | YES | NULL | ì œí•œ ì½ê¸° ì‹œê°„(ì´ˆ) |
| re_reading_limit_time | INT | YES | NULL | ë‹¤ì‹œì½ê¸° ì œí•œ ì‹œê°„(ì´ˆ) |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (lesson_id)
- FOREIGN KEY (volume_id) REFERENCES book_volume(volume_id)
- UNIQUE KEY uk_volume_lesson (volume_id, lesson_number)
- INDEX idx_lesson_number (lesson_number)

**ë‹¨ê³„ë³„ ì‹œê°„ ì„¤ì • ì˜ˆì‹œ**:
```sql
-- Aë‹¨ê³„ (1ê¶Œ 1ê°•)
reading_target_time = 180 (3ë¶„)
reading_limit_time = NULL (ì œí•œ ì—†ìŒ)
re_reading_limit_time = 160 (2ë¶„ 40ì´ˆ)

-- Bë‹¨ê³„ (6ê¶Œ 1ê°•)
reading_target_time = NULL
reading_limit_time = 180 (3ë¶„)
re_reading_limit_time = 170 (2ë¶„ 50ì´ˆ)

-- Cë‹¨ê³„ (11ê¶Œ 1ê°•)
reading_target_time = NULL
reading_limit_time = 180 (3ë¶„)
re_reading_limit_time = 180 (3ë¶„)
```

---

### 3.3 ë¼ì´ì„ ìŠ¤ ê´€ë¦¬

#### ğŸ“Œ license (ë¼ì´ì„ ìŠ¤)

**í…Œì´ë¸” ì„¤ëª…**: ê¶Œ ì‚¬ìš© ê¶Œí•œ ê´€ë¦¬

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| license_id | BINARY(16) | NO | - | ë¼ì´ì„ ìŠ¤ ID (PK, UUID) |
| user_id | BINARY(16) | NO | - | ì‚¬ìš©ì ID (FK) |
| volume_id | BINARY(16) | NO | - | ê¶Œ ID (FK) |
| granted_at | DATETIME(6) | NO | - | ë¶€ì—¬ ì¼ì‹œ |
| expire_date | DATETIME(6) | NO | - | ë§Œë£Œ ì¼ì (ë¶€ì—¬+6ê°œì›”) |
| status | ENUM('active','completed','expired') | NO | 'active' | ìƒíƒœ |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |
| updated_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìˆ˜ì • ì¼ì‹œ |

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (license_id)
- FOREIGN KEY (user_id) REFERENCES user(user_id)
- FOREIGN KEY (volume_id) REFERENCES book_volume(volume_id)
- INDEX idx_user_status (user_id, status)
- INDEX idx_expire_date (expire_date)

**ìƒíƒœ ì •ì˜**:
- `active`: ì‚¬ìš© ì¤‘ (ì§„í–‰ ê°€ëŠ¥)
- `completed`: í•™ìŠµ ì™„ë£Œ (ëª¨ë“  ê°• ì„±ê³µ)
- `expired`: ê¸°í•œ ë§Œë£Œ (ì§„í–‰ ë¶ˆê°€, ì¡°íšŒë§Œ ê°€ëŠ¥)

---

### 3.4 í•™ìŠµ ìˆ˜í–‰ ë° ê²°ê³¼

#### ğŸ“Œ lesson_attempt (ì°¨ì‹œ)

**í…Œì´ë¸” ì„¤ëª…**: ê°•ì¢Œ í•™ìŠµ ì‹œë„ (ì°¨ì‹œ)

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| attempt_id | BINARY(16) | NO | - | ì°¨ì‹œ ID (PK, UUID) |
| user_id | BINARY(16) | NO | - | ì‚¬ìš©ì ID (FK) |
| license_id | BINARY(16) | NO | - | ë¼ì´ì„ ìŠ¤ ID (FK) |
| lesson_id | BINARY(16) | NO | - | ê°•ì¢Œ ID (FK) |
| attempt_number | INT | NO | - | ì°¨ì‹œ ë²ˆí˜¸ (1,2,3...) |
| result | ENUM('success','fail','in_progress') | NO | 'in_progress' | ê²°ê³¼ |
| started_at | DATETIME(6) | NO | - | ì‹œì‘ ì¼ì‹œ |
| completed_at | DATETIME(6) | YES | NULL | ì™„ë£Œ ì¼ì‹œ |
| total_elapsed_time | INT | YES | NULL | ëˆ„ì  í•™ìŠµ ì‹œê°„(ì´ˆ) |
| fail_reason | VARCHAR(100) | YES | NULL | ì‹¤íŒ¨ ì‚¬ìœ  |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |
| updated_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìˆ˜ì • ì¼ì‹œ |

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (attempt_id)
- FOREIGN KEY (user_id) REFERENCES user(user_id)
- FOREIGN KEY (license_id) REFERENCES license(license_id)
- FOREIGN KEY (lesson_id) REFERENCES lesson(lesson_id)
- INDEX idx_user_lesson (user_id, lesson_id)
- INDEX idx_started_at (started_at)

**fail_reason ì˜ˆì‹œ**:
- "ë‹¤ì‹œì½ê¸° ì œí•œ ì‹œê°„ ì´ˆê³¼"
- "ë¬¸ì œí™•ì¸ ëª¨ë¥´ëŠ” ë¬¸ì œ ì´ˆê³¼"
- "ë¬¸ì œí’€ì´ ì˜¤ë‹µ ë¬¸ì œ ì´ˆê³¼"

---

#### ğŸ“Œ section_result (êµ¬ê°„ë³„ ê²°ê³¼)

**í…Œì´ë¸” ì„¤ëª…**: 9ê°œ í•™ìŠµ êµ¬ê°„ë³„ ìƒì„¸ ê²°ê³¼

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| result_id | BINARY(16) | NO | - | ê²°ê³¼ ID (PK, UUID) |
| attempt_id | BINARY(16) | NO | - | ì°¨ì‹œ ID (FK) |
| section_type | ENUM(...) | NO | - | í•™ìŠµ êµ¬ê°„ ìœ í˜• |
| elapsed_time | INT | YES | NULL | ì†Œìš” ì‹œê°„(ì´ˆ) |
| reading_speed | INT | YES | NULL | ë¶„ë‹¹ ê¸€ì ìˆ˜ |
| unknown_question_count | INT | YES | NULL | ëª¨ë¥´ëŠ” ë¬¸ì œ ê°œìˆ˜ |
| correct_count | INT | YES | NULL | ì •ë‹µ ê°œìˆ˜ |
| total_count | INT | YES | NULL | ì „ì²´ ë¬¸í•­ ìˆ˜ |
| wrong_count | INT | YES | NULL | ì˜¤ë‹µ ê°œìˆ˜ |
| unknown_answer_count | INT | YES | NULL | ëª¨ë¦„ ì„ íƒ ê°œìˆ˜ |
| comprehension_score | DECIMAL(5,2) | YES | NULL | ì´í•´ë„ ì ìˆ˜ |
| story_order_attempts | INT | YES | NULL | ì¤„ê±°ë¦¬ìˆœì„œ ì‹œë„ íšŸìˆ˜ |
| story_order_result | ENUM(...) | YES | NULL | ì¤„ê±°ë¦¬ìˆœì„œ ê²°ê³¼ |
| traffic_light | ENUM(...) | YES | NULL | ì‹ í˜¸ë“± ìƒíƒœ |
| section_data | JSON | YES | NULL | êµ¬ê°„ë³„ ì¶”ê°€ ë°ì´í„° |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |

**section_type ENUM ê°’**:
```sql
'title_reading',      -- ì œëª©ì½ê¸°
'vocab_check',        -- ì–´íœ˜í™•ì¸
'passage_reading',    -- ì§€ë¬¸ì½ê¸°
'question_check',     -- ë¬¸ì œí™•ì¸
're_reading',         -- ë‹¤ì‹œì½ê¸°
'problem_solving',    -- ë¬¸ì œí’€ì´
'info_processing',    -- ì •ë³´ì²˜ë¦¬
'story_order',        -- ì¤„ê±°ë¦¬ìˆœì„œ
'vocab_problem'       -- ì–´íœ˜ë¬¸ì œ
```

**traffic_light ENUM ê°’**:
```sql
'good',      -- ì¢‹ìŒ
'normal',    -- í‘œì¤€
'slow',      -- ëŠë¦¼
'fast',      -- ë¹ ë¦„
'bad',       -- ë‚˜ì¨
'exceeded'   -- ì œí•œ ì‹œê°„ ì´ˆê³¼
```

**story_order_result ENUM ê°’**:
```sql
'success_first',   -- 1íšŒ ì„±ê³µ
'success_second',  -- 2íšŒ ì„±ê³µ
'fail'             -- 2íšŒ ì‹¤íŒ¨
```

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (result_id)
- FOREIGN KEY (attempt_id) REFERENCES lesson_attempt(attempt_id)
- UNIQUE KEY uk_attempt_section (attempt_id, section_type)
- INDEX idx_section_type (section_type)

**section_data JSON ì˜ˆì‹œ**:
```json
{
  "question_check": {
    "unknown_questions": [1, 3, 5],
    "highlighted_keywords": {
      "1": ["í•µì‹¬ì–´1", "í•µì‹¬ì–´2"],
      "2": ["í•µì‹¬ì–´3"]
    }
  },
  "problem_solving": {
    "answers": [1, 2, 0, 4, 5, 3],  // 0 = ëª¨ë¥´ê² ì–´ìš”
    "correct_answers": [1, 2, 3, 4, 5, 6],
    "is_critical": [false, false, false, false, false, true]
  },
  "info_processing": {
    "student_selections": {
      "1": [1, 2],
      "2": [5, 6]
    },
    "model_answer": {
      "1": [1, 2, 3],
      "2": [5, 6, 7]
    }
  }
}
```

---

### 3.5 ì–´íœ˜ ê´€ë¦¬

#### ğŸ“Œ vocabulary (ì–´íœ˜)

**í…Œì´ë¸” ì„¤ëª…**: ê°•ì¢Œë³„ ì–´íœ˜ ì •ë³´

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| vocab_id | BINARY(16) | NO | - | ì–´íœ˜ ID (PK, UUID) |
| lesson_id | BINARY(16) | NO | - | ê°•ì¢Œ ID (FK) |
| word | VARCHAR(100) | NO | - | ì–´íœ˜ |
| meaning | TEXT | NO | - | ëœ» |
| example_sentence | TEXT | YES | NULL | ì˜ˆë¬¸ |
| hint | TEXT | YES | NULL | íŒíŠ¸ |
| display_order | INT | NO | - | ë…¸ì¶œ ìˆœì„œ |
| tag_level2 | VARCHAR(50) | YES | NULL | 2ì°¨ íƒœê·¸ |
| tag_level3 | VARCHAR(50) | YES | NULL | 3ì°¨ íƒœê·¸ |
| vocab_type | ENUM('core','thinking','context') | YES | NULL | í•µì‹¬ì–´/ì‚¬ê³ ì–´/ë§¥ë½ì–´ |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (vocab_id)
- FOREIGN KEY (lesson_id) REFERENCES lesson(lesson_id)
- INDEX idx_lesson_order (lesson_id, display_order)
- INDEX idx_word (word)

**vocab_type ì •ì˜**:
- `core`: í•µì‹¬ì–´
- `thinking`: ì‚¬ê³ ì–´
- `context`: ë§¥ë½ì–´

---

#### ğŸ“Œ vocab_problem (ì–´íœ˜ ë¬¸ì œ)

**í…Œì´ë¸” ì„¤ëª…**: ì–´íœ˜ë‹¹ 3ê°œ ë¬¸ì œ (ìš°ì„ ìˆœìœ„ë³„)

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| problem_id | BINARY(16) | NO | - | ë¬¸ì œ ID (PK, UUID) |
| vocab_id | BINARY(16) | NO | - | ì–´íœ˜ ID (FK) |
| priority | INT | NO | - | ìš°ì„ ìˆœìœ„ (1,2,3) |
| problem_type | VARCHAR(50) | YES | NULL | ë¬¸ì œ ìœ í˜• |
| question | TEXT | NO | - | ë¬¸ì œ ì§€ë¬¸ |
| option_1 | VARCHAR(255) | YES | NULL | ë³´ê¸° 1 |
| option_2 | VARCHAR(255) | YES | NULL | ë³´ê¸° 2 |
| option_3 | VARCHAR(255) | YES | NULL | ë³´ê¸° 3 |
| option_4 | VARCHAR(255) | YES | NULL | ë³´ê¸° 4 |
| option_5 | VARCHAR(255) | YES | NULL | ë³´ê¸° 5 |
| option_6 | VARCHAR(255) | YES | NULL | ë³´ê¸° 6 |
| correct_answer | INT | NO | - | ì •ë‹µ ë²ˆí˜¸ (1~6) |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (problem_id)
- FOREIGN KEY (vocab_id) REFERENCES vocabulary(vocab_id)
- INDEX idx_vocab_priority (vocab_id, priority)

**priority ì •ì˜**:
- `1`: ì–´íœ˜ë¬¸ì œ êµ¬ê°„ ì¶œì œ
- `2`: ì˜¤ëŠ˜ì˜ ì–´íœ˜ / í…Œë§ˆ í•™ìŠµ ì¶œì œ
- `3`: ì˜¤ëŠ˜ì˜ ì–´íœ˜ / í…Œë§ˆ í•™ìŠµ ì¶œì œ

---

#### ğŸ“Œ vocab_learning (ì–´íœ˜ í•™ìŠµ í˜„í™©)

**í…Œì´ë¸” ì„¤ëª…**: ì‚¬ìš©ìë³„ ì–´íœ˜ ì•„ëŠ”/ëª¨ë¥´ëŠ” ìƒíƒœ ê´€ë¦¬

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| learning_id | BINARY(16) | NO | - | í•™ìŠµ ID (PK, UUID) |
| user_id | BINARY(16) | NO | - | ì‚¬ìš©ì ID (FK) |
| vocab_id | BINARY(16) | NO | - | ì–´íœ˜ ID (FK) |
| status | ENUM('known','unknown') | NO | - | ì•„ëŠ”/ëª¨ë¥´ëŠ” ì–´íœ˜ |
| student_example | TEXT | YES | NULL | í•™ìƒ ì‘ì„± ì˜ˆë¬¸ |
| last_correct_at | DATETIME(6) | YES | NULL | ë§ˆì§€ë§‰ ì •ë‹µ ì¼ì‹œ |
| last_wrong_at | DATETIME(6) | YES | NULL | ë§ˆì§€ë§‰ ì˜¤ë‹µ ì¼ì‹œ |
| total_correct_count | INT | NO | 0 | ëˆ„ì  ì •ë‹µ íšŸìˆ˜ |
| total_wrong_count | INT | NO | 0 | ëˆ„ì  ì˜¤ë‹µ íšŸìˆ˜ |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |
| updated_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìˆ˜ì • ì¼ì‹œ |

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (learning_id)
- FOREIGN KEY (user_id) REFERENCES user(user_id)
- FOREIGN KEY (vocab_id) REFERENCES vocabulary(vocab_id)
- UNIQUE KEY uk_user_vocab (user_id, vocab_id)
- INDEX idx_status (user_id, status)
- INDEX idx_last_correct (last_correct_at)

---

#### ğŸ“Œ vocab_learning_result (ì–´íœ˜ í•™ìŠµ ê²°ê³¼)

**í…Œì´ë¸” ì„¤ëª…**: ì˜¤ëŠ˜ì˜ ì–´íœ˜, í…Œë§ˆ í•™ìŠµ ê²°ê³¼ ì´ë ¥

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| result_id | BINARY(16) | NO | - | ê²°ê³¼ ID (PK, UUID) |
| learning_id | BINARY(16) | NO | - | í•™ìŠµ ID (FK) |
| learning_type | ENUM(...) | YES | NULL | í•™ìŠµ ìœ í˜• |
| lesson_ids | TEXT | YES | NULL | ì„ íƒ ê°•ì¢Œ ID (JSON) |
| total_problems | INT | YES | NULL | ì¶œì œ ë¬¸í•­ ìˆ˜ |
| correct_count | INT | YES | NULL | ì •ë‹µ ê°œìˆ˜ |
| completed_at | DATETIME(6) | NO | - | ì™„ë£Œ ì¼ì‹œ |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |

**learning_type ENUM ê°’**:
```sql
'today_vocab',          -- ì˜¤ëŠ˜ì˜ ì–´íœ˜
'theme_my_select',      -- ë‚´ê°€ ì„ íƒí•œ ì–´íœ˜
'theme_recent',         -- ìµœê·¼ ë§íŒ ì–´íœ˜
'theme_recommend',      -- ì¶”ì²œ ì–´íœ˜
'theme_old'             -- ì˜¤ë«ë™ì•ˆ ì•ˆ ë³¸ ì–´íœ˜
```

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (result_id)
- FOREIGN KEY (learning_id) REFERENCES vocab_learning(learning_id)
- INDEX idx_completed_at (completed_at)

---

### 3.6 ì„œìˆ  ìš”ì•½

#### ğŸ“Œ summary (ì„œìˆ  ìš”ì•½)

**í…Œì´ë¸” ì„¤ëª…**: ê°•ì¢Œë³„ í•™ìƒ ì‘ì„± ìš”ì•½

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| summary_id | BINARY(16) | NO | - | ìš”ì•½ ID (PK, UUID) |
| user_id | BINARY(16) | NO | - | ì‚¬ìš©ì ID (FK) |
| lesson_id | BINARY(16) | NO | - | ê°•ì¢Œ ID (FK) |
| prompt_type | VARCHAR(50) | YES | NULL | ë°œë¬¸ ìœ í˜• |
| hint | TEXT | YES | NULL | íŒíŠ¸ ë‚´ìš© |
| model_answer | TEXT | YES | NULL | ëª¨ë²” ë‹µì•ˆ |
| student_text | TEXT | YES | NULL | í•™ìƒ ì‘ì„± ìš”ì•½ |
| ai_correction | TEXT | YES | NULL | AI êµì • ë‚´ìš© |
| is_completed | BOOLEAN | NO | FALSE | ì‘ì„± ì™„ë£Œ ì—¬ë¶€ |
| completed_at | DATETIME(6) | YES | NULL | ì‘ì„± ì™„ë£Œ ì¼ì‹œ |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |
| updated_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìˆ˜ì • ì¼ì‹œ |

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (summary_id)
- FOREIGN KEY (user_id) REFERENCES user(user_id)
- FOREIGN KEY (lesson_id) REFERENCES lesson(lesson_id)
- UNIQUE KEY uk_user_lesson_summary (user_id, lesson_id)
- INDEX idx_completed (is_completed, completed_at)

**prompt_type ì˜ˆì‹œ**:
- "type1": ì§€ë¬¸ ë‚œì´ë„ë³„ ë°œë¬¸ ìœ í˜• 1
- "type2": ì§€ë¬¸ ë‚œì´ë„ë³„ ë°œë¬¸ ìœ í˜• 2
- "type3": ì§€ë¬¸ ë‚œì´ë„ë³„ ë°œë¬¸ ìœ í˜• 3
- "type4": ì§€ë¬¸ ë‚œì´ë„ë³„ ë°œë¬¸ ìœ í˜• 4

---

### 3.7 í€˜ìŠ¤íŠ¸ ì‹œìŠ¤í…œ

#### ğŸ“Œ quest_product (í€˜ìŠ¤íŠ¸ ìƒí’ˆ)

**í…Œì´ë¸” ì„¤ëª…**: í€˜ìŠ¤íŠ¸ ìƒí’ˆ ì •ë³´ (ë””ì €íŠ¸)

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| product_id | BINARY(16) | NO | - | ìƒí’ˆ ID (PK, UUID) |
| product_name | VARCHAR(100) | NO | - | ìƒí’ˆëª… |
| product_image | VARCHAR(255) | YES | NULL | ìƒí’ˆ ì´ë¯¸ì§€ URL |
| ingredient_images | JSON | YES | NULL | ì¬ë£Œ ì´ë¯¸ì§€ ëª©ë¡ |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (product_id)

**ingredient_images JSON ì˜ˆì‹œ**:
```json
{
  "lesson_success": "ì¬ë£Œ1_ì´ë¯¸ì§€.png",
  "today_vocab": "ì¬ë£Œ2_ì´ë¯¸ì§€.png",
  "today_summary": "ì¬ë£Œ3_ì´ë¯¸ì§€.png",
  "theme_learning": "ì¬ë£Œ4_ì´ë¯¸ì§€.png"
}
```

---

#### ğŸ“Œ quest (í€˜ìŠ¤íŠ¸)

**í…Œì´ë¸” ì„¤ëª…**: ì‚¬ìš©ìë³„ í€˜ìŠ¤íŠ¸ ì§„í–‰

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| quest_id | BINARY(16) | NO | - | í€˜ìŠ¤íŠ¸ ID (PK, UUID) |
| user_id | BINARY(16) | NO | - | ì‚¬ìš©ì ID (FK) |
| product_id | BINARY(16) | NO | - | ìƒí’ˆ ID (FK) |
| status | ENUM('in_progress','completed') | NO | 'in_progress' | ìƒíƒœ |
| is_excellent | BOOLEAN | NO | FALSE | ìš°ìˆ˜ ìƒí’ˆ ì—¬ë¶€ |
| selected_at | DATETIME(6) | NO | - | ìƒí’ˆ ì„ íƒ ì¼ì‹œ |
| completed_at | DATETIME(6) | YES | NULL | ìƒí’ˆ íšë“ ì¼ì‹œ |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (quest_id)
- FOREIGN KEY (user_id) REFERENCES user(user_id)
- FOREIGN KEY (product_id) REFERENCES quest_product(product_id)
- INDEX idx_user_status (user_id, status)

---

#### ğŸ“Œ quest_progress (í€˜ìŠ¤íŠ¸ ì§„í–‰ ìƒí™©)

**í…Œì´ë¸” ì„¤ëª…**: 4ê°€ì§€ í€˜ìŠ¤íŠ¸ ìœ í˜•ë³„ ì§„í–‰ë¥ 

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| progress_id | BINARY(16) | NO | - | ì§„í–‰ ID (PK, UUID) |
| quest_id | BINARY(16) | NO | - | í€˜ìŠ¤íŠ¸ ID (FK) |
| quest_type | ENUM(...) | NO | - | í€˜ìŠ¤íŠ¸ ìœ í˜• |
| completed_count | INT | NO | 0 | ì™„ë£Œ íšŸìˆ˜ |
| target_count | INT | NO | - | ëª©í‘œ íšŸìˆ˜ |
| progress_rate | DECIMAL(5,2) | NO | 0.00 | ì§„í–‰ë¥  (%) |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |
| updated_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìˆ˜ì • ì¼ì‹œ |

**quest_type ENUM ê°’**:
```sql
'lesson_success',    -- ê°•ì¢Œ ì„±ê³µ (ëª©í‘œ: 10)
'today_vocab',       -- ì˜¤ëŠ˜ì˜ ì–´íœ˜ ì™„ë£Œ (ëª©í‘œ: 7)
'today_summary',     -- ì˜¤ëŠ˜ì˜ ìš”ì•½ ì™„ë£Œ (ëª©í‘œ: 7)
'theme_learning'     -- í…Œë§ˆ í•™ìŠµ 1íšŒ ì™„ë£Œ (ëª©í‘œ: 5)
```

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (progress_id)
- FOREIGN KEY (quest_id) REFERENCES quest(quest_id)
- UNIQUE KEY uk_quest_type (quest_id, quest_type)

---

#### ğŸ“Œ quest_history (í€˜ìŠ¤íŠ¸ ì´ë ¥)

**í…Œì´ë¸” ì„¤ëª…**: í€˜ìŠ¤íŠ¸ í™œë™ ì¼ìë³„ ì´ë ¥

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| history_id | BINARY(16) | NO | - | ì´ë ¥ ID (PK, UUID) |
| quest_id | BINARY(16) | NO | - | í€˜ìŠ¤íŠ¸ ID (FK) |
| quest_type | ENUM(...) | NO | - | í€˜ìŠ¤íŠ¸ ìœ í˜• |
| activity_date | DATE | NO | - | í™œë™ ì¼ì |
| lesson_id | BINARY(16) | YES | NULL | ê°•ì¢Œ ì„±ê³µ ì‹œ lesson_id |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (history_id)
- FOREIGN KEY (quest_id) REFERENCES quest(quest_id)
- INDEX idx_quest_date (quest_id, activity_date)

**ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™**:
- ë™ì¼ ë‚ ì§œ ë™ì¼ í€˜ìŠ¤íŠ¸ íƒ€ì… ì¤‘ë³µ ë°©ì§€
- í…Œë§ˆ í•™ìŠµ: ê°™ì€ ë‚  ì—¬ëŸ¬ ë²ˆ ì§„í–‰í•´ë„ 1íšŒë§Œ ê¸°ë¡

---

#### ğŸ“Œ coupon (ì¿ í°)

**í…Œì´ë¸” ì„¤ëª…**: í€˜ìŠ¤íŠ¸ ì™„ë£Œ ë³´ìƒ ì¿ í°

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| coupon_id | BINARY(16) | NO | - | ì¿ í° ID (PK, UUID) |
| user_id | BINARY(16) | NO | - | ì‚¬ìš©ì ID (FK) |
| quest_id | BINARY(16) | YES | NULL | í€˜ìŠ¤íŠ¸ ID (FK) |
| coupon_type | ENUM('excellent','normal') | NO | - | ìš°ìˆ˜/ì¼ë°˜ ì¿ í° |
| coupon_code | VARCHAR(50) | NO | - | ì¿ í° ì½”ë“œ (UNIQUE, ëŒ€ì†Œë¬¸ì êµ¬ë¶„) |
| discount_amount | DECIMAL(10,2) | YES | NULL | í• ì¸ ê¸ˆì•¡ |
| issued_at | DATETIME(6) | NO | - | ë°œê¸‰ ì¼ì‹œ |
| expire_date | DATETIME(6) | YES | NULL | ë§Œë£Œ ì¼ì |
| used_at | DATETIME(6) | YES | NULL | ì‚¬ìš© ì¼ì‹œ |
| status | ENUM('available','used','expired') | NO | 'available' | ìƒíƒœ |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (coupon_id)
- FOREIGN KEY (user_id) REFERENCES user(user_id)
- FOREIGN KEY (quest_id) REFERENCES quest(quest_id)
- UNIQUE KEY uk_coupon_code (coupon_code)
- INDEX idx_user_status (user_id, status)
- INDEX idx_expire_date (expire_date)

---

### 3.8 ì•Œë¦¼ ì‹œìŠ¤í…œ

#### ğŸ“Œ notification (ì•Œë¦¼)

**í…Œì´ë¸” ì„¤ëª…**: ì‚¬ìš©ì ì•Œë¦¼ ê´€ë¦¬

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| notification_id | BINARY(16) | NO | - | ì•Œë¦¼ ID (PK, UUID) |
| user_id | BINARY(16) | NO | - | ì‚¬ìš©ì ID (FK) |
| type | ENUM(...) | NO | - | ì•Œë¦¼ ìœ í˜• |
| title | VARCHAR(255) | NO | - | ì•Œë¦¼ ì œëª© |
| content | TEXT | YES | NULL | ì•Œë¦¼ ë‚´ìš© |
| related_id | BINARY(16) | YES | NULL | ê´€ë ¨ ë°ì´í„° ID |
| is_read | BOOLEAN | NO | FALSE | ì½ìŒ ì—¬ë¶€ |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |
| read_at | DATETIME(6) | YES | NULL | ì½ì€ ì¼ì‹œ |

**type ENUM ê°’**:
```sql
'gift_point',        -- ì„ ë¬¼í•˜ê¸°
'qna_answer',        -- QnA ë‹µë³€ ë„ì°©
'license_expire'     -- ë¼ì´ì„ ìŠ¤ ì‚¬ìš© ê¸°í•œ
```

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (notification_id)
- FOREIGN KEY (user_id) REFERENCES user(user_id)
- INDEX idx_user_read (user_id, is_read)
- INDEX idx_created_at (created_at DESC)

**related_id ìš©ë„**:
- gift_point: ì„ ë¬¼ ì´ë ¥ ID
- qna_answer: QnA ID
- license_expire: license_id

---

### 3.9 ë¡œê·¸ ë° í†µê³„

#### ğŸ“Œ activity_log (í•™ìŠµ í™œë™ ë¡œê·¸)

**í…Œì´ë¸” ì„¤ëª…**: ì¼ìë³„ í•™ìŠµ í™œë™ ê¸°ë¡

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| log_id | BINARY(16) | NO | - | ë¡œê·¸ ID (PK, UUID) |
| user_id | BINARY(16) | NO | - | ì‚¬ìš©ì ID (FK) |
| activity_type | ENUM(...) | NO | - | í™œë™ ìœ í˜• |
| activity_date | DATE | NO | - | í™œë™ ì¼ì |
| reference_id | BINARY(16) | YES | NULL | ì°¸ì¡° ID |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |

**activity_type ENUM ê°’**:
```sql
'lesson',            -- ê°•ì¢Œ í•™ìŠµ
'vocab_learning',    -- ì–´íœ˜ í•™ìŠµ
'summary'            -- ì„œìˆ  ìš”ì•½
```

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (log_id)
- FOREIGN KEY (user_id) REFERENCES user(user_id)
- INDEX idx_user_date (user_id, activity_date DESC)

**reference_id ìš©ë„**:
- lesson: attempt_id
- vocab_learning: learning_result_id
- summary: summary_id

---

#### ğŸ“Œ volume_progress_cache (ì§„í–‰ë¥  ìºì‹œ)

**í…Œì´ë¸” ì„¤ëª…**: ê¶Œë³„ ì§„í–‰ë¥  ìºì‹±

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| cache_id | BINARY(16) | NO | - | ìºì‹œ ID (PK, UUID) |
| user_id | BINARY(16) | NO | - | ì‚¬ìš©ì ID (FK) |
| license_id | BINARY(16) | NO | - | ë¼ì´ì„ ìŠ¤ ID (FK) |
| volume_id | BINARY(16) | NO | - | ê¶Œ ID (FK) |
| total_lessons | INT | NO | - | ì´ ê°•ì¢Œ ìˆ˜ |
| completed_lessons | INT | NO | 0 | ì™„ë£Œ ê°•ì¢Œ ìˆ˜ |
| progress_rate | DECIMAL(5,2) | NO | 0.00 | ì§„í–‰ë¥  (%) |
| last_lesson_at | DATETIME(6) | YES | NULL | ë§ˆì§€ë§‰ í•™ìŠµ ì¼ì‹œ |
| updated_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìˆ˜ì • ì¼ì‹œ |

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (cache_id)
- FOREIGN KEY (user_id) REFERENCES user(user_id)
- FOREIGN KEY (license_id) REFERENCES license(license_id)
- FOREIGN KEY (volume_id) REFERENCES book_volume(volume_id)
- UNIQUE KEY uk_user_license_volume (user_id, license_id, volume_id)

---

#### ğŸ“Œ daily_learning_stats (ì¼ë³„ í•™ìŠµ í†µê³„)

**í…Œì´ë¸” ì„¤ëª…**: ì¼ë³„ í•™ìŠµ í†µê³„ ì§‘ê³„

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|--------|------|
| stat_id | BINARY(16) | NO | - | í†µê³„ ID (PK, UUID) |
| user_id | BINARY(16) | NO | - | ì‚¬ìš©ì ID (FK) |
| stat_date | DATE | NO | - | í†µê³„ ì¼ì |
| lesson_attempts | INT | NO | 0 | ê°•ì¢Œ ì‹œë„ íšŸìˆ˜ |
| lesson_success | INT | NO | 0 | ê°•ì¢Œ ì„±ê³µ íšŸìˆ˜ |
| vocab_learning_count | INT | NO | 0 | ì–´íœ˜ í•™ìŠµ íšŸìˆ˜ |
| summary_completed | INT | NO | 0 | ìš”ì•½ ì™„ë£Œ ê°œìˆ˜ |
| total_study_time | INT | NO | 0 | ì´ í•™ìŠµ ì‹œê°„(ì´ˆ) |
| created_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìƒì„± ì¼ì‹œ |
| updated_at | DATETIME(6) | NO | CURRENT_TIMESTAMP(6) | ìˆ˜ì • ì¼ì‹œ |

**ì œì•½ì¡°ê±´**:
- PRIMARY KEY (stat_id)
- FOREIGN KEY (user_id) REFERENCES user(user_id)
- UNIQUE KEY uk_user_date (user_id, stat_date)
- INDEX idx_stat_date (stat_date)

---

## 4. ì¸ë±ìŠ¤ ì„¤ê³„

### 4.1 ê¸°ë³¸ ì¸ë±ìŠ¤ ì „ëµ

**ì›ì¹™**:
1. ëª¨ë“  ì™¸ë˜í‚¤ì— ì¸ë±ìŠ¤ ìƒì„±
2. ìì£¼ ì¡°íšŒë˜ëŠ” ì»¬ëŸ¼ ì¡°í•©ì— ë³µí•© ì¸ë±ìŠ¤
3. ë‚ ì§œ ë²”ìœ„ ì¡°íšŒìš© ì¸ë±ìŠ¤
4. WHERE, JOIN, ORDER BYì— ì‚¬ìš©ë˜ëŠ” ì»¬ëŸ¼ ìš°ì„ 

### 4.2 ì£¼ìš” ì¸ë±ìŠ¤ ëª©ë¡

```sql
-- user í…Œì´ë¸”
CREATE INDEX idx_name ON user(name);
CREATE INDEX idx_grade ON user(grade);

-- license í…Œì´ë¸”
CREATE INDEX idx_user_status ON license(user_id, status);
CREATE INDEX idx_expire_date ON license(expire_date);

-- lesson_attempt í…Œì´ë¸”
CREATE INDEX idx_user_lesson ON lesson_attempt(user_id, lesson_id);
CREATE INDEX idx_user_lesson_result ON lesson_attempt(user_id, lesson_id, result);
CREATE INDEX idx_started_at ON lesson_attempt(started_at);

-- section_result í…Œì´ë¸”
CREATE INDEX idx_section_type ON section_result(section_type);
CREATE INDEX idx_attempt_type_time ON section_result(attempt_id, section_type, elapsed_time);

-- vocab_learning í…Œì´ë¸”
CREATE INDEX idx_status ON vocab_learning(user_id, status);
CREATE INDEX idx_status_updated ON vocab_learning(user_id, status, updated_at);
CREATE INDEX idx_last_correct ON vocab_learning(last_correct_at);

-- activity_log í…Œì´ë¸”
CREATE INDEX idx_user_date ON activity_log(user_id, activity_date DESC);
CREATE INDEX idx_user_type_date ON activity_log(user_id, activity_type, activity_date DESC);

-- notification í…Œì´ë¸”
CREATE INDEX idx_user_read ON notification(user_id, is_read);
CREATE INDEX idx_created_at ON notification(created_at DESC);
```

### 4.3 ì»¤ë²„ë§ ì¸ë±ìŠ¤ ì œì•ˆ

```sql
-- ìµœê·¼ í•™ìŠµ ì´ë ¥ ì¡°íšŒ ìµœì í™”
CREATE INDEX idx_user_lesson_complete ON lesson_attempt(
  user_id, 
  lesson_id, 
  result, 
  completed_at DESC
);

-- ì–´íœ˜ í•™ìŠµ í˜„í™© ì¡°íšŒ ìµœì í™”
CREATE INDEX idx_vocab_status_date ON vocab_learning(
  user_id, 
  status, 
  last_correct_at DESC, 
  last_wrong_at DESC
);
```

---

## 5. DDL (Data Definition Language)

### 5.1 ì „ì²´ DDL ìŠ¤í¬ë¦½íŠ¸

```sql
-- ============================================
-- ì½ì“° ë¬¸í•´ë ¥ í•™ìŠµ í”Œë«í¼ ë°ì´í„°ë² ì´ìŠ¤
-- ============================================

-- ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
CREATE DATABASE IF NOT EXISTS icks_literacy
  DEFAULT CHARACTER SET utf8mb4
  DEFAULT COLLATE utf8mb4_0900_ai_ci;

USE icks_literacy;

-- ============================================
-- 1. ì‚¬ìš©ì ê´€ë¦¬
-- ============================================

CREATE TABLE user (
  user_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  name VARCHAR(100) NOT NULL COMMENT 'í•™ìƒ ì´ë¦„',
  grade VARCHAR(20) COMMENT 'í•™ë…„ ì •ë³´',
  user_type ENUM('student', 'admin') DEFAULT 'student' COMMENT 'ì‚¬ìš©ì ìœ í˜•',
  profile_image VARCHAR(255) COMMENT 'í”„ë¡œí•„ ì´ë¯¸ì§€ URL',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  updated_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6) COMMENT 'ìˆ˜ì • ì¼ì‹œ',
  INDEX idx_name (name),
  INDEX idx_grade (grade)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='ì‚¬ìš©ì ì •ë³´';

-- ============================================
-- 2. êµì¬ ë° ê°•ì¢Œ ë©”íƒ€ë°ì´í„°
-- ============================================

CREATE TABLE book_volume (
  volume_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  volume_number INT NOT NULL UNIQUE COMMENT 'ê¶Œ ë²ˆí˜¸ (1~15)',
  title VARCHAR(255) NOT NULL COMMENT 'ê¶Œ ì œëª©',
  stage ENUM('A', 'B', 'C') NOT NULL COMMENT 'ë‚œì´ë„ ë‹¨ê³„',
  total_lessons INT NOT NULL COMMENT 'ì´ ê°•ì¢Œ ìˆ˜ (12 or 15)',
  avg_word_count VARCHAR(50) COMMENT 'í‰ê·  ê¸€ì ìˆ˜ ë²”ìœ„',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  INDEX idx_volume_number (volume_number)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='ê¶Œ ë©”íƒ€ë°ì´í„°';

CREATE TABLE lesson (
  lesson_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  volume_id BINARY(16) NOT NULL COMMENT 'ê¶Œ ID',
  lesson_number INT NOT NULL COMMENT 'ê°• ë²ˆí˜¸',
  title VARCHAR(255) NOT NULL COMMENT 'ì§€ë¬¸ ì œëª©',
  word_count INT COMMENT 'ì§€ë¬¸ ê¸€ì ìˆ˜',
  content_image VARCHAR(255) COMMENT 'ì œëª©ì½ê¸° ì´ë¯¸ì§€ URL',
  passage_text TEXT COMMENT 'ê°•ì¢Œ ì§€ë¬¸ ë‚´ìš©',
  reading_target_time INT COMMENT 'ëª©í‘œ ì½ê¸° ì‹œê°„(ì´ˆ)',
  reading_limit_time INT COMMENT 'ì œí•œ ì½ê¸° ì‹œê°„(ì´ˆ)',
  re_reading_limit_time INT COMMENT 'ë‹¤ì‹œì½ê¸° ì œí•œ ì‹œê°„(ì´ˆ)',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  FOREIGN KEY (volume_id) REFERENCES book_volume(volume_id),
  UNIQUE KEY uk_volume_lesson (volume_id, lesson_number),
  INDEX idx_lesson_number (lesson_number)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='ê°•ì¢Œ ì •ë³´';

-- ============================================
-- 3. ë¼ì´ì„ ìŠ¤ ê´€ë¦¬
-- ============================================

CREATE TABLE license (
  license_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  user_id BINARY(16) NOT NULL COMMENT 'ì‚¬ìš©ì ID',
  volume_id BINARY(16) NOT NULL COMMENT 'ê¶Œ ID',
  granted_at DATETIME(6) NOT NULL COMMENT 'ë¶€ì—¬ ì¼ì‹œ',
  expire_date DATETIME(6) NOT NULL COMMENT 'ë§Œë£Œ ì¼ì (ë¶€ì—¬ í›„ 6ê°œì›”)',
  status ENUM('active', 'completed', 'expired') DEFAULT 'active' COMMENT 'ìƒíƒœ: active(ì‚¬ìš©ì¤‘), completed(í•™ìŠµì™„ë£Œ), expired(ê¸°í•œë§Œë£Œ)',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  updated_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6) COMMENT 'ìˆ˜ì • ì¼ì‹œ',
  FOREIGN KEY (user_id) REFERENCES user(user_id),
  FOREIGN KEY (volume_id) REFERENCES book_volume(volume_id),
  INDEX idx_user_status (user_id, status),
  INDEX idx_expire_date (expire_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='ë¼ì´ì„ ìŠ¤';

-- ============================================
-- 4. í•™ìŠµ ìˆ˜í–‰ ë° ê²°ê³¼
-- ============================================

CREATE TABLE lesson_attempt (
  attempt_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  user_id BINARY(16) NOT NULL COMMENT 'ì‚¬ìš©ì ID',
  license_id BINARY(16) NOT NULL COMMENT 'ë¼ì´ì„ ìŠ¤ ID',
  lesson_id BINARY(16) NOT NULL COMMENT 'ê°•ì¢Œ ID',
  attempt_number INT NOT NULL COMMENT 'ì°¨ì‹œ ë²ˆí˜¸',
  result ENUM('success', 'fail', 'in_progress') DEFAULT 'in_progress' COMMENT 'ê²°ê³¼',
  started_at DATETIME(6) NOT NULL COMMENT 'í•™ìŠµ ì‹œì‘ ì¼ì‹œ',
  completed_at DATETIME(6) COMMENT 'í•™ìŠµ ì™„ë£Œ ì¼ì‹œ',
  total_elapsed_time INT COMMENT 'ëˆ„ì  í•™ìŠµ ì‹œê°„(ì´ˆ)',
  fail_reason VARCHAR(100) COMMENT 'ì‹¤íŒ¨ ì‚¬ìœ  (íƒˆë½ êµ¬ê°„)',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  updated_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6) COMMENT 'ìˆ˜ì • ì¼ì‹œ',
  FOREIGN KEY (user_id) REFERENCES user(user_id),
  FOREIGN KEY (license_id) REFERENCES license(license_id),
  FOREIGN KEY (lesson_id) REFERENCES lesson(lesson_id),
  INDEX idx_user_lesson (user_id, lesson_id),
  INDEX idx_started_at (started_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='ì°¨ì‹œ ìˆ˜í–‰';

CREATE TABLE section_result (
  result_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  attempt_id BINARY(16) NOT NULL COMMENT 'ì°¨ì‹œ ID',
  section_type ENUM(
    'title_reading', 'vocab_check', 'passage_reading', 
    'question_check', 're_reading', 'problem_solving', 
    'info_processing', 'story_order', 'vocab_problem'
  ) NOT NULL COMMENT 'í•™ìŠµ êµ¬ê°„ ìœ í˜•',
  elapsed_time INT COMMENT 'ì†Œìš” ì‹œê°„(ì´ˆ)',
  reading_speed INT COMMENT 'ë¶„ë‹¹ ê¸€ì ìˆ˜ (ì½ê¸° êµ¬ê°„)',
  unknown_question_count INT COMMENT 'ëª¨ë¥´ëŠ” ë¬¸ì œ ê°œìˆ˜ (ë¬¸ì œí™•ì¸)',
  correct_count INT COMMENT 'ì •ë‹µ ê°œìˆ˜',
  total_count INT COMMENT 'ì „ì²´ ë¬¸í•­ ìˆ˜',
  wrong_count INT COMMENT 'ì˜¤ë‹µ ê°œìˆ˜',
  unknown_answer_count INT COMMENT 'ëª¨ë¦„ ì„ íƒ ê°œìˆ˜',
  comprehension_score DECIMAL(5,2) COMMENT 'ì´í•´ë„ ì ìˆ˜',
  story_order_attempts INT COMMENT 'ì¤„ê±°ë¦¬ìˆœì„œ ì‹œë„ íšŸìˆ˜',
  story_order_result ENUM('success_first', 'success_second', 'fail') COMMENT 'ì¤„ê±°ë¦¬ìˆœì„œ ê²°ê³¼',
  traffic_light ENUM('good', 'normal', 'slow', 'fast', 'bad', 'exceeded') COMMENT 'ì‹ í˜¸ë“± ìƒíƒœ',
  section_data JSON COMMENT 'êµ¬ê°„ë³„ ì¶”ê°€ ì„¸ë¶€ ë°ì´í„°',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  FOREIGN KEY (attempt_id) REFERENCES lesson_attempt(attempt_id),
  UNIQUE KEY uk_attempt_section (attempt_id, section_type),
  INDEX idx_section_type (section_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='êµ¬ê°„ë³„ ê²°ê³¼';

-- ============================================
-- 5. ì–´íœ˜ ê´€ë¦¬
-- ============================================

CREATE TABLE vocabulary (
  vocab_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  lesson_id BINARY(16) NOT NULL COMMENT 'ê°•ì¢Œ ID',
  word VARCHAR(100) NOT NULL COMMENT 'ì–´íœ˜',
  meaning TEXT NOT NULL COMMENT 'ëœ»',
  example_sentence TEXT COMMENT 'ì˜ˆë¬¸',
  hint TEXT COMMENT 'íŒíŠ¸',
  display_order INT NOT NULL COMMENT 'ë…¸ì¶œ ìˆœì„œ',
  tag_level2 VARCHAR(50) COMMENT '2ì°¨ íƒœê·¸',
  tag_level3 VARCHAR(50) COMMENT '3ì°¨ íƒœê·¸',
  vocab_type ENUM('core', 'thinking', 'context') COMMENT 'í•µì‹¬ì–´/ì‚¬ê³ ì–´/ë§¥ë½ì–´',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  FOREIGN KEY (lesson_id) REFERENCES lesson(lesson_id),
  INDEX idx_lesson_order (lesson_id, display_order),
  INDEX idx_word (word)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='ì–´íœ˜ ì •ë³´';

CREATE TABLE vocab_problem (
  problem_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  vocab_id BINARY(16) NOT NULL COMMENT 'ì–´íœ˜ ID',
  priority INT NOT NULL COMMENT 'ìš°ì„ ìˆœìœ„ (1,2,3)',
  problem_type VARCHAR(50) COMMENT 'ë¬¸ì œ ìœ í˜•',
  question TEXT NOT NULL COMMENT 'ë¬¸ì œ ì§€ë¬¸',
  option_1 VARCHAR(255) COMMENT 'ë³´ê¸° 1',
  option_2 VARCHAR(255) COMMENT 'ë³´ê¸° 2',
  option_3 VARCHAR(255) COMMENT 'ë³´ê¸° 3',
  option_4 VARCHAR(255) COMMENT 'ë³´ê¸° 4',
  option_5 VARCHAR(255) COMMENT 'ë³´ê¸° 5',
  option_6 VARCHAR(255) COMMENT 'ë³´ê¸° 6',
  correct_answer INT NOT NULL COMMENT 'ì •ë‹µ ë²ˆí˜¸ (1~6)',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  FOREIGN KEY (vocab_id) REFERENCES vocabulary(vocab_id),
  INDEX idx_vocab_priority (vocab_id, priority)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='ì–´íœ˜ ë¬¸ì œ';

CREATE TABLE vocab_learning (
  learning_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  user_id BINARY(16) NOT NULL COMMENT 'ì‚¬ìš©ì ID',
  vocab_id BINARY(16) NOT NULL COMMENT 'ì–´íœ˜ ID',
  status ENUM('known', 'unknown') NOT NULL COMMENT 'ì•„ëŠ” ì–´íœ˜/ëª¨ë¥´ëŠ” ì–´íœ˜',
  student_example TEXT COMMENT 'í•™ìƒì´ ì‘ì„±í•œ ì˜ˆë¬¸',
  last_correct_at DATETIME(6) COMMENT 'ë§ˆì§€ë§‰ ì •ë‹µ ì¼ì‹œ',
  last_wrong_at DATETIME(6) COMMENT 'ë§ˆì§€ë§‰ ì˜¤ë‹µ ì¼ì‹œ',
  total_correct_count INT DEFAULT 0 COMMENT 'ëˆ„ì  ì •ë‹µ íšŸìˆ˜',
  total_wrong_count INT DEFAULT 0 COMMENT 'ëˆ„ì  ì˜¤ë‹µ íšŸìˆ˜',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  updated_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6) COMMENT 'ìˆ˜ì • ì¼ì‹œ',
  FOREIGN KEY (user_id) REFERENCES user(user_id),
  FOREIGN KEY (vocab_id) REFERENCES vocabulary(vocab_id),
  UNIQUE KEY uk_user_vocab (user_id, vocab_id),
  INDEX idx_status (user_id, status),
  INDEX idx_last_correct (last_correct_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='ì–´íœ˜ í•™ìŠµ í˜„í™©';

CREATE TABLE vocab_learning_result (
  result_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  learning_id BINARY(16) NOT NULL COMMENT 'í•™ìŠµ ID',
  learning_type ENUM('today_vocab', 'theme_my_select', 'theme_recent', 'theme_recommend', 'theme_old') COMMENT 'í•™ìŠµ ìœ í˜•',
  lesson_ids TEXT COMMENT 'ì„ íƒí•œ ê°•ì¢Œ ID ëª©ë¡ (JSON array)',
  total_problems INT COMMENT 'ì¶œì œ ë¬¸í•­ ìˆ˜',
  correct_count INT COMMENT 'ì •ë‹µ ê°œìˆ˜',
  completed_at DATETIME(6) NOT NULL COMMENT 'ì™„ë£Œ ì¼ì‹œ',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  FOREIGN KEY (learning_id) REFERENCES vocab_learning(learning_id),
  INDEX idx_completed_at (completed_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='ì–´íœ˜ í•™ìŠµ ê²°ê³¼';

-- ============================================
-- 6. ì„œìˆ  ìš”ì•½
-- ============================================

CREATE TABLE summary (
  summary_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  user_id BINARY(16) NOT NULL COMMENT 'ì‚¬ìš©ì ID',
  lesson_id BINARY(16) NOT NULL COMMENT 'ê°•ì¢Œ ID',
  prompt_type VARCHAR(50) COMMENT 'ë°œë¬¸ ìœ í˜• (ì§€ë¬¸ ë‚œì´ë„ë³„)',
  hint TEXT COMMENT 'íŒíŠ¸ ë‚´ìš©',
  model_answer TEXT COMMENT 'ëª¨ë²” ë‹µì•ˆ',
  student_text TEXT COMMENT 'í•™ìƒì´ ì‘ì„±í•œ ìš”ì•½',
  ai_correction TEXT COMMENT 'AI êµì • ë‚´ìš©',
  is_completed BOOLEAN DEFAULT FALSE COMMENT 'ì‘ì„± ì™„ë£Œ ì—¬ë¶€',
  completed_at DATETIME(6) COMMENT 'ì‘ì„± ì™„ë£Œ ì¼ì‹œ',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  updated_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6) COMMENT 'ìˆ˜ì • ì¼ì‹œ',
  FOREIGN KEY (user_id) REFERENCES user(user_id),
  FOREIGN KEY (lesson_id) REFERENCES lesson(lesson_id),
  UNIQUE KEY uk_user_lesson_summary (user_id, lesson_id),
  INDEX idx_completed (is_completed, completed_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='ì„œìˆ  ìš”ì•½';

-- ============================================
-- 7. í€˜ìŠ¤íŠ¸ ì‹œìŠ¤í…œ
-- ============================================

CREATE TABLE quest_product (
  product_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  product_name VARCHAR(100) NOT NULL COMMENT 'ìƒí’ˆëª… (ë””ì €íŠ¸ëª…)',
  product_image VARCHAR(255) COMMENT 'ìƒí’ˆ ì´ë¯¸ì§€ URL',
  ingredient_images JSON COMMENT 'ì¬ë£Œ ì´ë¯¸ì§€ ëª©ë¡',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='í€˜ìŠ¤íŠ¸ ìƒí’ˆ';

CREATE TABLE quest (
  quest_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  user_id BINARY(16) NOT NULL COMMENT 'ì‚¬ìš©ì ID',
  product_id BINARY(16) NOT NULL COMMENT 'ìƒí’ˆ ID',
  status ENUM('in_progress', 'completed') DEFAULT 'in_progress' COMMENT 'ìƒíƒœ',
  is_excellent BOOLEAN DEFAULT FALSE COMMENT 'ìš°ìˆ˜ ìƒí’ˆ ì—¬ë¶€',
  selected_at DATETIME(6) NOT NULL COMMENT 'ìƒí’ˆ ì„ íƒ ì¼ì‹œ',
  completed_at DATETIME(6) COMMENT 'ìƒí’ˆ íšë“ ì¼ì‹œ',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  FOREIGN KEY (user_id) REFERENCES user(user_id),
  FOREIGN KEY (product_id) REFERENCES quest_product(product_id),
  INDEX idx_user_status (user_id, status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='í€˜ìŠ¤íŠ¸';

CREATE TABLE quest_progress (
  progress_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  quest_id BINARY(16) NOT NULL COMMENT 'í€˜ìŠ¤íŠ¸ ID',
  quest_type ENUM('lesson_success', 'today_vocab', 'today_summary', 'theme_learning') NOT NULL COMMENT 'í€˜ìŠ¤íŠ¸ ìœ í˜•',
  completed_count INT DEFAULT 0 COMMENT 'ì™„ë£Œ íšŸìˆ˜',
  target_count INT NOT NULL COMMENT 'ëª©í‘œ íšŸìˆ˜ (10,7,7,5)',
  progress_rate DECIMAL(5,2) DEFAULT 0.00 COMMENT 'ì§„í–‰ë¥  (%)',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  updated_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6) COMMENT 'ìˆ˜ì • ì¼ì‹œ',
  FOREIGN KEY (quest_id) REFERENCES quest(quest_id),
  UNIQUE KEY uk_quest_type (quest_id, quest_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='í€˜ìŠ¤íŠ¸ ì§„í–‰ ìƒí™©';

CREATE TABLE quest_history (
  history_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  quest_id BINARY(16) NOT NULL COMMENT 'í€˜ìŠ¤íŠ¸ ID',
  quest_type ENUM('lesson_success', 'today_vocab', 'today_summary', 'theme_learning') NOT NULL COMMENT 'í€˜ìŠ¤íŠ¸ ìœ í˜•',
  activity_date DATE NOT NULL COMMENT 'í™œë™ ì¼ì',
  lesson_id BINARY(16) COMMENT 'ê°•ì¢Œ ì„±ê³µ ì‹œ lesson_id',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  FOREIGN KEY (quest_id) REFERENCES quest(quest_id),
  INDEX idx_quest_date (quest_id, activity_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='í€˜ìŠ¤íŠ¸ ì´ë ¥';

CREATE TABLE coupon (
  coupon_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  user_id BINARY(16) NOT NULL COMMENT 'ì‚¬ìš©ì ID',
  quest_id BINARY(16) COMMENT 'í€˜ìŠ¤íŠ¸ ID',
  coupon_type ENUM('excellent', 'normal') NOT NULL COMMENT 'ìš°ìˆ˜/ì¼ë°˜ ì¿ í°',
  coupon_code VARCHAR(50) COLLATE utf8mb4_bin UNIQUE NOT NULL COMMENT 'ì¿ í° ì½”ë“œ (ëŒ€ì†Œë¬¸ì êµ¬ë¶„)',
  discount_amount DECIMAL(10,2) COMMENT 'í• ì¸ ê¸ˆì•¡',
  issued_at DATETIME(6) NOT NULL COMMENT 'ë°œê¸‰ ì¼ì‹œ',
  expire_date DATETIME(6) COMMENT 'ë§Œë£Œ ì¼ì',
  used_at DATETIME(6) COMMENT 'ì‚¬ìš© ì¼ì‹œ',
  status ENUM('available', 'used', 'expired') DEFAULT 'available' COMMENT 'ìƒíƒœ',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  FOREIGN KEY (user_id) REFERENCES user(user_id),
  FOREIGN KEY (quest_id) REFERENCES quest(quest_id),
  INDEX idx_user_status (user_id, status),
  INDEX idx_expire_date (expire_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='ì¿ í°';

-- ============================================
-- 8. ì•Œë¦¼ ê´€ë¦¬
-- ============================================

CREATE TABLE notification (
  notification_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  user_id BINARY(16) NOT NULL COMMENT 'ì‚¬ìš©ì ID',
  type ENUM('gift_point', 'qna_answer', 'license_expire') NOT NULL COMMENT 'ì•Œë¦¼ ìœ í˜•',
  title VARCHAR(255) NOT NULL COMMENT 'ì•Œë¦¼ ì œëª©',
  content TEXT COMMENT 'ì•Œë¦¼ ë‚´ìš©',
  related_id BINARY(16) COMMENT 'ê´€ë ¨ ë°ì´í„° ID (ì„ ë¬¼/QnA/ë¼ì´ì„ ìŠ¤)',
  is_read BOOLEAN DEFAULT FALSE COMMENT 'ì½ìŒ ì—¬ë¶€',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  read_at DATETIME(6) COMMENT 'ì½ì€ ì¼ì‹œ',
  FOREIGN KEY (user_id) REFERENCES user(user_id),
  INDEX idx_user_read (user_id, is_read),
  INDEX idx_created_at (created_at DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='ì•Œë¦¼';

-- ============================================
-- 9. í•™ìŠµ í™œë™ ë¡œê·¸
-- ============================================

CREATE TABLE activity_log (
  log_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  user_id BINARY(16) NOT NULL COMMENT 'ì‚¬ìš©ì ID',
  activity_type ENUM('lesson', 'vocab_learning', 'summary') NOT NULL COMMENT 'í™œë™ ìœ í˜•',
  activity_date DATE NOT NULL COMMENT 'í™œë™ ì¼ì',
  reference_id BINARY(16) COMMENT 'ì°¸ì¡° ID (attempt_id, learning_result_id, summary_id)',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  FOREIGN KEY (user_id) REFERENCES user(user_id),
  INDEX idx_user_date (user_id, activity_date DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='í•™ìŠµ í™œë™ ë¡œê·¸';

-- ============================================
-- 10. ìºì‹œ ë° í†µê³„
-- ============================================

CREATE TABLE volume_progress_cache (
  cache_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  user_id BINARY(16) NOT NULL COMMENT 'ì‚¬ìš©ì ID',
  license_id BINARY(16) NOT NULL COMMENT 'ë¼ì´ì„ ìŠ¤ ID',
  volume_id BINARY(16) NOT NULL COMMENT 'ê¶Œ ID',
  total_lessons INT NOT NULL COMMENT 'ì´ ê°•ì¢Œ ìˆ˜',
  completed_lessons INT DEFAULT 0 COMMENT 'ì™„ë£Œ ê°•ì¢Œ ìˆ˜',
  progress_rate DECIMAL(5,2) DEFAULT 0.00 COMMENT 'ì§„í–‰ë¥  (%)',
  last_lesson_at DATETIME(6) COMMENT 'ë§ˆì§€ë§‰ í•™ìŠµ ì¼ì‹œ',
  updated_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6) COMMENT 'ìˆ˜ì • ì¼ì‹œ',
  FOREIGN KEY (user_id) REFERENCES user(user_id),
  FOREIGN KEY (license_id) REFERENCES license(license_id),
  FOREIGN KEY (volume_id) REFERENCES book_volume(volume_id),
  UNIQUE KEY uk_user_license_volume (user_id, license_id, volume_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='ê¶Œë³„ ì§„í–‰ë¥  ìºì‹œ';

CREATE TABLE daily_learning_stats (
  stat_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  user_id BINARY(16) NOT NULL COMMENT 'ì‚¬ìš©ì ID',
  stat_date DATE NOT NULL COMMENT 'í†µê³„ ì¼ì',
  lesson_attempts INT DEFAULT 0 COMMENT 'ê°•ì¢Œ ì‹œë„ íšŸìˆ˜',
  lesson_success INT DEFAULT 0 COMMENT 'ê°•ì¢Œ ì„±ê³µ íšŸìˆ˜',
  vocab_learning_count INT DEFAULT 0 COMMENT 'ì–´íœ˜ í•™ìŠµ íšŸìˆ˜',
  summary_completed INT DEFAULT 0 COMMENT 'ìš”ì•½ ì™„ë£Œ ê°œìˆ˜',
  total_study_time INT DEFAULT 0 COMMENT 'ì´ í•™ìŠµ ì‹œê°„(ì´ˆ)',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  updated_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6) COMMENT 'ìˆ˜ì • ì¼ì‹œ',
  FOREIGN KEY (user_id) REFERENCES user(user_id),
  UNIQUE KEY uk_user_date (user_id, stat_date),
  INDEX idx_stat_date (stat_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='ì¼ë³„ í•™ìŠµ í†µê³„';
```

---

## 6. í™•ì¥ ì„¤ê³„

### 6.1 ì‚¬ìš©ì í–‰ë™ ë¡œê·¸

```sql
CREATE TABLE user_behavior_log (
  log_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  user_id BINARY(16) NOT NULL COMMENT 'ì‚¬ìš©ì ID',
  session_id BINARY(16) COMMENT 'ì„¸ì…˜ ID',
  event_type VARCHAR(50) NOT NULL COMMENT 'page_view, button_click, section_start, section_end',
  event_target VARCHAR(100) COMMENT 'ì´ë²¤íŠ¸ ëŒ€ìƒ (ë²„íŠ¼ëª…, í˜ì´ì§€ëª…)',
  event_data JSON COMMENT 'ì¶”ê°€ ì´ë²¤íŠ¸ ë°ì´í„°',
  timestamp DATETIME(6) NOT NULL COMMENT 'ì´ë²¤íŠ¸ ë°œìƒ ì¼ì‹œ',
  FOREIGN KEY (user_id) REFERENCES user(user_id),
  INDEX idx_user_timestamp (user_id, timestamp),
  INDEX idx_event_type (event_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='ì‚¬ìš©ì í–‰ë™ ë¡œê·¸';
```

### 6.2 AI í•™ìŠµ í”¼ì²˜

```sql
CREATE TABLE learning_feature (
  feature_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  user_id BINARY(16) NOT NULL COMMENT 'ì‚¬ìš©ì ID',
  feature_date DATE NOT NULL COMMENT 'í”¼ì²˜ ì¼ì',
  avg_reading_speed DECIMAL(8,2) COMMENT 'í‰ê·  ì½ê¸° ì†ë„',
  avg_comprehension DECIMAL(5,2) COMMENT 'í‰ê·  ì´í•´ë„',
  weak_vocab_types JSON COMMENT 'ì·¨ì•½ ì–´íœ˜ ìœ í˜• ëª©ë¡',
  weak_question_types JSON COMMENT 'ì·¨ì•½ ë¬¸ì œ ìœ í˜•',
  study_pattern JSON COMMENT 'í•™ìŠµ íŒ¨í„´ (ìš”ì¼ë³„, ì‹œê°„ëŒ€ë³„)',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  FOREIGN KEY (user_id) REFERENCES user(user_id),
  UNIQUE KEY uk_user_date (user_id, feature_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='AI í•™ìŠµ í”¼ì²˜';
```

### 6.3 ì‚¬ìš©ì í”¼ë“œë°±

```sql
CREATE TABLE user_feedback (
  feedback_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  user_id BINARY(16) NOT NULL COMMENT 'ì‚¬ìš©ì ID',
  feedback_type ENUM('difficulty', 'satisfaction', 'recommendation') NOT NULL COMMENT 'í”¼ë“œë°± ìœ í˜•',
  target_type ENUM('lesson', 'vocab', 'summary') NOT NULL COMMENT 'ëŒ€ìƒ ìœ í˜•',
  target_id BINARY(16) NOT NULL COMMENT 'ëŒ€ìƒ ID (lesson_id, vocab_id, summary_id)',
  rating INT COMMENT 'í‰ì  (1~5)',
  comment TEXT COMMENT 'ì˜ê²¬',
  created_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ìƒì„± ì¼ì‹œ',
  FOREIGN KEY (user_id) REFERENCES user(user_id),
  INDEX idx_user_target (user_id, target_type, target_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='ì‚¬ìš©ì í”¼ë“œë°±';
```

### 6.4 ë¬¸ì œ ë³€ê²½ ì´ë ¥

```sql
CREATE TABLE vocab_problem_history (
  history_id BINARY(16) PRIMARY KEY DEFAULT (UUID_TO_BIN(UUID(), 1)) COMMENT 'UUID',
  problem_id BINARY(16) NOT NULL COMMENT 'ë¬¸ì œ ID',
  version INT NOT NULL COMMENT 'ë²„ì „',
  changed_field VARCHAR(50) COMMENT 'ë³€ê²½ í•„ë“œ',
  old_value TEXT COMMENT 'ì´ì „ ê°’',
  new_value TEXT COMMENT 'ìƒˆ ê°’',
  changed_by BINARY(16) COMMENT 'ë³€ê²½ì (admin user_id)',
  changed_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'ë³€ê²½ ì¼ì‹œ',
  FOREIGN KEY (problem_id) REFERENCES vocab_problem(problem_id),
  INDEX idx_problem_version (problem_id, version DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
COMMENT='ë¬¸ì œ ë³€ê²½ ì´ë ¥';
```

### 6.5 íŒŒí‹°ì…”ë‹ ì „ëµ

```sql
-- activity_log ì›”ë³„ íŒŒí‹°ì…”ë‹
ALTER TABLE activity_log 
PARTITION BY RANGE (TO_DAYS(activity_date)) (
  PARTITION p202501 VALUES LESS THAN (TO_DAYS('2025-02-01')),
  PARTITION p202502 VALUES LESS THAN (TO_DAYS('2025-03-01')),
  PARTITION p202503 VALUES LESS THAN (TO_DAYS('2025-04-01')),
  PARTITION p_future VALUES LESS THAN MAXVALUE
);

-- user_behavior_log ì›”ë³„ íŒŒí‹°ì…”ë‹
ALTER TABLE user_behavior_log
PARTITION BY RANGE (TO_DAYS(DATE(timestamp))) (
  PARTITION p202501 VALUES LESS THAN (TO_DAYS('2025-02-01')),
  PARTITION p202502 VALUES LESS THAN (TO_DAYS('2025-03-01')),
  PARTITION p202503 VALUES LESS THAN (TO_DAYS('2025-04-01')),
  PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

---

## 7. ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜

### 7.1 ì´ˆê¸° ë°ì´í„° ì‚½ì…

#### ê¶Œ(book_volume) ì´ˆê¸° ë°ì´í„°

```sql
-- Aë‹¨ê³„ (1~5ê¶Œ)
INSERT INTO book_volume (volume_id, volume_number, title, stage, total_lessons, avg_word_count) VALUES
(UUID(), 1, '1ê¶Œ', 'A', 12, '1~3', NOW(6)),
(UUID(), 2, '2ê¶Œ', 'A', 12, '1~3', NOW(6)),
(UUID(), 3, '3ê¶Œ', 'A', 12, '1~3', NOW(6)),
(UUID(), 4, '4ê¶Œ', 'A', 12, '4~5', NOW(6)),
(UUID(), 5, '5ê¶Œ', 'A', 12, '4~5', NOW(6));

-- Bë‹¨ê³„ (6~10ê¶Œ)
INSERT INTO book_volume (volume_id, volume_number, title, stage, total_lessons, avg_word_count) VALUES
(UUID(), 6, '6ê¶Œ', 'B', 15, '6~8', NOW(6)),
(UUID(), 7, '7ê¶Œ', 'B', 15, '6~8', NOW(6)),
(UUID(), 8, '8ê¶Œ', 'B', 15, '6~8', NOW(6)),
(UUID(), 9, '9ê¶Œ', 'B', 15, '9~10', NOW(6)),
(UUID(), 10, '10ê¶Œ', 'B', 15, '9~10', NOW(6));

-- Cë‹¨ê³„ (11~15ê¶Œ)
INSERT INTO book_volume (volume_id, volume_number, title, stage, total_lessons, avg_word_count) VALUES
(UUID(), 11, '11ê¶Œ', 'C', 12, '11~15', NOW(6)),
(UUID(), 12, '12ê¶Œ', 'C', 12, '11~15', NOW(6)),
(UUID(), 13, '13ê¶Œ', 'C', 12, '11~15', NOW(6)),
(UUID(), 14, '14ê¶Œ', 'C', 12, '11~15', NOW(6)),
(UUID(), 15, '15ê¶Œ', 'C', 12, '11~15', NOW(6));
```

#### í€˜ìŠ¤íŠ¸ ìƒí’ˆ(quest_product) ì´ˆê¸° ë°ì´í„°

```sql
INSERT INTO quest_product (product_id, product_name, product_image, ingredient_images) VALUES
(UUID(), 'ë¹™ìˆ˜', 'bingsu.png', JSON_OBJECT(
  'lesson_success', 'ice.png',
  'today_vocab', 'syrup.png',
  'today_summary', 'fruit.png',
  'theme_learning', 'topping.png'
)),
(UUID(), 'ì¼€ì´í¬', 'cake.png', JSON_OBJECT(
  'lesson_success', 'bread.png',
  'today_vocab', 'cream.png',
  'today_summary', 'strawberry.png',
  'theme_learning', 'candle.png'
));
```

### 7.2 ë°±ì—… ì „ëµ

```sql
-- ì „ì²´ ë°±ì—…
mysqldump -u root -p icks_literacy > icks_literacy_backup_YYYYMMDD.sql

-- í…Œì´ë¸”ë³„ ë°±ì—…
mysqldump -u root -p icks_literacy lesson_attempt section_result > attempt_backup_YYYYMMDD.sql

-- ë°ì´í„°ë§Œ ë°±ì—… (êµ¬ì¡° ì œì™¸)
mysqldump -u root -p --no-create-info icks_literacy > data_backup_YYYYMMDD.sql
```

---

## ğŸ“š ë¶€ë¡

### A. ë°ì´í„° íƒ€ì… ì •ì˜ ê°€ì´ë“œ

| ìš©ë„ | ë°ì´í„° íƒ€ì… | ë¹„ê³  |
|------|------------|------|
| ê¸°ë³¸í‚¤ | BINARY(16) | UUID |
| ì™¸ë˜í‚¤ | BINARY(16) | UUID ì°¸ì¡° |
| ì´ë¦„/ì œëª© | VARCHAR(100~255) | ê°€ë³€ ê¸¸ì´ |
| ê¸´ í…ìŠ¤íŠ¸ | TEXT | 65,535ì |
| ì •ìˆ˜ | INT | ì‹œê°„(ì´ˆ), ê°œìˆ˜ ë“± |
| ì†Œìˆ˜ | DECIMAL(5,2) | ì´í•´ë„, ì§„í–‰ë¥  |
| ë‚ ì§œ/ì‹œê°„ | DATETIME(6) | ë§ˆì´í¬ë¡œì´ˆ |
| ë‚ ì§œë§Œ | DATE | YYYY-MM-DD |
| JSON | JSON | ê°€ë³€ êµ¬ì¡° ë°ì´í„° |
| ENUM | ENUM(...) | ì •í•´ì§„ ê°’ ëª©ë¡ |
| ì°¸/ê±°ì§“ | BOOLEAN | TRUE/FALSE |

### B. ë„¤ì´ë° ì»¨ë²¤ì…˜

```yaml
í…Œì´ë¸”ëª…: snake_case (ì†Œë¬¸ì, ì–¸ë”ìŠ¤ì½”ì–´)
  ì˜ˆ: lesson_attempt, vocab_learning

ì»¬ëŸ¼ëª…: snake_case (ì†Œë¬¸ì, ì–¸ë”ìŠ¤ì½”ì–´)
  ì˜ˆ: user_id, created_at

ì¸ë±ìŠ¤ëª…:
  - ì¼ë°˜: idx_{ì»¬ëŸ¼ëª…}
  - ë³µí•©: idx_{ì»¬ëŸ¼1}_{ì»¬ëŸ¼2}
  - ìœ ë‹ˆí¬: uk_{ì»¬ëŸ¼ëª…}

ì™¸ë˜í‚¤ëª…:
  - fk_{í…Œì´ë¸”ëª…}_{ì»¬ëŸ¼ëª…}
```

### C. UUID ë³€í™˜ ì¿¼ë¦¬ ê°€ì´ë“œ

#### UUID ìƒì„± ë° ë³€í™˜

```sql
-- 1. UUID ìƒì„± (ë¬¸ìì—´)
SELECT UUID();
-- ê²°ê³¼: '550e8400-e29b-41d4-a716-446655440000'

-- 2. UUID â†’ BINARY ë³€í™˜ (ì €ì¥ìš©)
SELECT UUID_TO_BIN('550e8400-e29b-41d4-a716-446655440000', 1);
-- ê²°ê³¼: 0x550ee29b41d4a716446655440000e284 (16 bytes)
-- swap_flag=1: íƒ€ì„ìŠ¤íƒ¬í”„ ë¶€ë¶„ì„ ì•ìœ¼ë¡œ ë°°ì¹˜í•˜ì—¬ ìˆœì°¨ì„± í™•ë³´

-- 3. BINARY â†’ UUID ë³€í™˜ (ì¡°íšŒìš©)
SELECT BIN_TO_UUID(user_id, 1) as user_id FROM user;
-- ê²°ê³¼: '550e8400-e29b-41d4-a716-446655440000'
```

#### INSERT ì¿¼ë¦¬

```sql
-- ë°©ë²• 1: DEFAULT ê°’ ì‚¬ìš© (ê¶Œì¥)
INSERT INTO user (name, grade, user_type)
VALUES ('í™ê¸¸ë™', 'ì´ˆë“±3', 'student');
-- user_idëŠ” ìë™ ìƒì„±: DEFAULT (UUID_TO_BIN(UUID(), 1))

-- ë°©ë²• 2: ëª…ì‹œì  UUID ì§€ì •
INSERT INTO user (user_id, name, grade)
VALUES (
  UUID_TO_BIN('550e8400-e29b-41d4-a716-446655440000', 1),
  'ê¹€ì² ìˆ˜',
  'ì´ˆë“±4'
);
```

#### SELECT ì¿¼ë¦¬

```sql
-- 1. UUIDë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ ì¡°íšŒ
SELECT
  BIN_TO_UUID(user_id, 1) as user_id,
  name,
  grade
FROM user
WHERE user_id = UUID_TO_BIN('550e8400-e29b-41d4-a716-446655440000', 1);

-- 2. ì—¬ëŸ¬ í…Œì´ë¸” JOIN
SELECT
  BIN_TO_UUID(u.user_id, 1) as user_id,
  u.name,
  BIN_TO_UUID(la.attempt_id, 1) as attempt_id,
  la.result
FROM user u
JOIN lesson_attempt la ON u.user_id = la.user_id
WHERE u.user_id = UUID_TO_BIN('550e8400-e29b-41d4-a716-446655440000', 1);

-- 3. ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µì—ì„œ ë³€í™˜ ì²˜ë¦¬ (ê¶Œì¥)
-- ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ UUID ë¬¸ìì—´ì„ ë°›ì•„ BINARYë¡œ ë³€í™˜ í›„ ì¿¼ë¦¬
-- ê²°ê³¼ë„ BINARYì—ì„œ UUID ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜
```

#### UPDATE/DELETE ì¿¼ë¦¬

```sql
-- UPDATE
UPDATE user
SET name = 'ì´ì˜í¬'
WHERE user_id = UUID_TO_BIN('550e8400-e29b-41d4-a716-446655440000', 1);

-- DELETE
DELETE FROM user
WHERE user_id = UUID_TO_BIN('550e8400-e29b-41d4-a716-446655440000', 1);
```

#### ì„±ëŠ¥ ìµœì í™” íŒ

```sql
-- 1. EXPLAINìœ¼ë¡œ ì‹¤í–‰ ê³„íš í™•ì¸
EXPLAIN SELECT * FROM lesson_attempt
WHERE user_id = UUID_TO_BIN('550e8400-e29b-41d4-a716-446655440000', 1)
AND result = 'success';

-- 2. ì¸ë±ìŠ¤ ì‚¬ìš© í™•ì¸
SHOW INDEX FROM lesson_attempt;

-- 3. ìŠ¬ë¡œìš° ì¿¼ë¦¬ ë¡œê·¸ í™œì„±í™”
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 2; -- 2ì´ˆ ì´ìƒ ì¿¼ë¦¬ ë¡œê·¸

-- 4. ì»¤ë²„ë§ ì¸ë±ìŠ¤ í™œìš© ì˜ˆì‹œ
SELECT
  BIN_TO_UUID(attempt_id, 1) as attempt_id,
  result,
  completed_at
FROM lesson_attempt
WHERE user_id = UUID_TO_BIN('550e8400-e29b-41d4-a716-446655440000', 1)
AND lesson_id = UUID_TO_BIN('7c9e6679-7425-40de-944b-e07fc1f90ae7', 1);
-- idx_user_lesson_complete ì¸ë±ìŠ¤ë¡œ ì»¤ë²„ë§

-- 5. JSON ì»¬ëŸ¼ ì¿¼ë¦¬
SELECT * FROM section_result
WHERE section_data->>'$.question_check.unknown_questions' LIKE '%[1,3]%';
```

#### ë§ˆì´ê·¸ë ˆì´ì…˜ ì¿¼ë¦¬ (ê¸°ì¡´ CHAR(36) â†’ BINARY(16))

```sql
-- ê¸°ì¡´ ë°ì´í„°ê°€ CHAR(36)ì¸ ê²½ìš° ë§ˆì´ê·¸ë ˆì´ì…˜

-- 1. ì„ì‹œ ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE user ADD COLUMN user_id_binary BINARY(16);

-- 2. ë°ì´í„° ë³€í™˜
UPDATE user
SET user_id_binary = UUID_TO_BIN(user_id, 1);

-- 3. ê¸°ì¡´ ì»¬ëŸ¼ ì‚­ì œ í›„ rename (ì£¼ì˜: ì™¸ë˜í‚¤ ì¬ìƒì„± í•„ìš”)
ALTER TABLE user DROP PRIMARY KEY;
ALTER TABLE user DROP COLUMN user_id;
ALTER TABLE user CHANGE COLUMN user_id_binary user_id BINARY(16);
ALTER TABLE user ADD PRIMARY KEY (user_id);
```

---

**ë¬¸ì„œ ë³€ê²½ ì´ë ¥**
- v1.1 (2025-10-23): UUID BINARY(16) ë§ˆì´ê·¸ë ˆì´ì…˜, ì½œë ˆì´ì…˜ utf8mb4_0900_ai_ci ë³€ê²½
- v1.0 (2025-10-23): ì´ˆì•ˆ ì‘ì„±

**ê´€ë ¨ ë¬¸ì„œ**
- í”„ë¡œì íŠ¸ ë¶„ì„ ë³´ê³ ì„œ: `01_í”„ë¡œì íŠ¸_ë¶„ì„_ë³´ê³ ì„œ.md`
- ê¸°ëŠ¥ ì •ì˜ì„œ: `02_ê¸°ëŠ¥_ì •ì˜ì„œ.md`
